<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>HOD Dashboard - Attendify</title>
<link rel="stylesheet" href="styles.css" />
</head>
<body>
<div class="dashboard-container">
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h2>Attendify</h2>
            <p>HOD Portal</p>
        </div>
        <nav class="sidebar-nav">
            <a class="nav-item" href="hod-dashboard.html" id="dashboardNav">Dashboard</a>
            <a class="nav-item" href="pending-requests.html" id="pendingNav">Pending Requests</a>
            <a class="nav-item" href="records-analytics.html" id="recordsNav">Records & Analytics</a>
            <a class="nav-item logout" href="login.html" id="logoutBtn">Logout</a>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <header class="dashboard-header" style="position: relative;">
            <h1>HOD Dashboard</h1>
            <div class="user-profile" style="position: relative; cursor: pointer;">
                <span id="profileName">HOD - Computer Science</span>
                <div class="profile-icon" id="profileIcon">H</div>
                <div id="profileDropdown" class="profile-dropdown" style="display: none;">
                    <form id="profileForm">
                        <h3>Profile Information</h3>
                        <label for="fullName">Full Name</label>
                        <input type="text" id="fullName" name="fullName" required />
                        <label for="department">Department</label>
                        <input type="text" id="department" name="department" disabled />
                        <label for="userId">User ID</label>
                        <input type="text" id="userId" name="userId" disabled />
                        <button type="submit">Update Profile</button>
                    </form>
                    <hr />
                    <form id="changePasswordForm">
                        <h3>Change Password</h3>
                        <label for="currentPassword">Current Password</label>
                        <input type="password" id="currentPassword" name="currentPassword" required />
                        <label for="newPassword">New Password</label>
                        <input type="password" id="newPassword" name="newPassword" required />
                        <label for="confirmPassword">Confirm New Password</label>
                        <input type="password" id="confirmPassword" name="confirmPassword" required />
                        <button type="submit">Change Password</button>
                    </form>
                </div>
            </div>
        </header>

        <!-- Stats Cards -->
        <div class="stats-grid">
            <div class="stat-card">
                <h3>Total Requests</h3>
                <p class="stat-number">45</p>
            </div>
            <div class="stat-card pending">
                <h3>Pending Approval</h3>
                <p class="stat-number">12</p>
            </div>
            <div class="stat-card approved">
                <h3>Approved Today</h3>
                <p class="stat-number">5</p>
            </div>
            <div class="stat-card rejected">
                <h3>Rejected</h3>
                <p class="stat-number">3</p>
            </div>
        </div>

        <!-- All Applications Section -->
        <div class="content-section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h2>All Leave Applications</h2>
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <label for="timeFilter" style="font-weight: 600; color: #4f46e5;">Filter by:</label>
                    <select id="timeFilter" style="padding: 0.5rem 1rem; border: 2px solid #4f46e5; border-radius: 8px; font-size: 1rem; cursor: pointer; background-color: white;">
                        <option value="week">This Week</option>
                        <option value="month">This Month</option>
                        <option value="6months">Last 6 Months</option>
                    </select>
                </div>
            </div>
            <table class="applications-table">
                <thead>
                    <tr>
                        <th>Application ID</th>
                        <th>Name</th>
                        <th>Type</th>
                        <th>Leave Type</th>
                        <th>Start Date</th>
                        <th>End Date</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="applicationsTableBody">
                    <!-- Table rows will be populated by JavaScript -->
                </tbody>
            </table>
        </div>
    </main>
</div>

<script>
    // Active navigation highlighting
    const currentPage = window.location.pathname.split('/').pop();
    const navLinks = document.querySelectorAll('.nav-item');
    
    navLinks.forEach(link => {
        if (link.getAttribute('href') === currentPage) {
            link.classList.add('active-nav');
        }
    });

    // Profile dropdown functionality
    const profileIcon = document.getElementById('profileIcon');
    const profileDropdown = document.getElementById('profileDropdown');
    const profileForm = document.getElementById('profileForm');
    const changePasswordForm = document.getElementById('changePasswordForm');

    profileIcon.addEventListener('click', () => {
        if (profileDropdown.style.display === 'none' || profileDropdown.style.display === '') {
            profileDropdown.style.display = 'block';
            profileForm.fullName.value = localStorage.getItem('hodFullName') || 'HOD Name';
            profileForm.department.value = localStorage.getItem('hodDepartment') || 'Computer Science';
            profileForm.userId.value = localStorage.getItem('hodUserId') || 'HOD001';
        } else {
            profileDropdown.style.display = 'none';
        }
    });

    profileForm.addEventListener('submit', e => {
        e.preventDefault();
        localStorage.setItem('hodFullName', profileForm.fullName.value);
        alert('Profile updated successfully!');
        profileDropdown.style.display = 'none';
    });

    changePasswordForm.addEventListener('submit', e => {
        e.preventDefault();
        const currentPass = changePasswordForm.currentPassword.value;
        const newPass = changePasswordForm.newPassword.value;
        const confirmPass = changePasswordForm.confirmPassword.value;
        
        if (newPass !== confirmPass) {
            alert('New passwords do not match!');
            return;
        }
        alert('Password changed successfully!');
        changePasswordForm.reset();
        profileDropdown.style.display = 'none';
    });

    // Populate HOD info from localStorage
    const hodDepartment = localStorage.getItem('hodDepartment') || 'Computer Science';
    const hodUserId = localStorage.getItem('hodUserId') || 'H';
    document.getElementById('profileName').textContent = 'HOD - ' + hodDepartment;
    document.getElementById('profileIcon').textContent = hodUserId.charAt(0).toUpperCase();

    // Logout
    document.getElementById('logoutBtn').addEventListener('click', e => {
        localStorage.clear();
    });

    // ===== ALL APPLICATIONS DATA =====
    const allApplicationsData = [
        { id: '2402300100011 (LA001)', name: 'Abhinav', type: 'Student', leaveType: 'Sick Leave', startDate: '2025-11-28', endDate: '2025-11-29', status: 'pending' },
        { id: '2402300100005 (LA002)', name: 'Aanya', type: 'Student', leaveType: 'Casual Leave', startDate: '2025-11-27', endDate: '2025-11-28', status: 'pending' },
        { id: 'FAC2020001 (FLA003)', name: 'Dr. Kaustubh Shukla', type: 'Faculty', leaveType: 'Emergency Leave', startDate: '2025-11-26', endDate: '2025-11-27', status: 'pending' },
        { id: '2402300100012 (LA004)', name: 'Abhishek', type: 'Student', leaveType: 'Sick Leave', startDate: '2025-11-25', endDate: '2025-11-26', status: 'approved' },
        { id: '2402300100013 (LA005)', name: 'Abhitenjay', type: 'Student', leaveType: 'Casual Leave', startDate: '2025-11-15', endDate: '2025-11-16', status: 'rejected' },
        { id: '2402300100005 (LA006)', name: 'Aanya', type: 'Student', leaveType: 'Medical Leave', startDate: '2025-11-10', endDate: '2025-11-12', status: 'approved' },
        { id: 'FAC2020002 (FLA007)', name: 'Prof. Vaishali Mogha', type: 'Faculty', leaveType: 'Conference Leave', startDate: '2025-11-05', endDate: '2025-11-07', status: 'approved' },
        { id: '2402300100011 (LA008)', name: 'Abhinav', type: 'Student', leaveType: 'Personal Leave', startDate: '2025-10-28', endDate: '2025-10-28', status: 'rejected' },
        { id: '2402300100012 (LA009)', name: 'Abhishek', type: 'Student', leaveType: 'Emergency Leave', startDate: '2025-10-15', endDate: '2025-10-16', status: 'approved' },
        { id: 'FAC2020001 (FLA010)', name: 'Dr. Kaustubh Shukla', type: 'Faculty', leaveType: 'Personal Leave', startDate: '2025-09-20', endDate: '2025-09-21', status: 'approved' },
        { id: '2402300100005 (LA011)', name: 'Aanya', type: 'Student', leaveType: 'Sick Leave', startDate: '2025-08-10', endDate: '2025-08-11', status: 'approved' },
        { id: '2402300100013 (LA012)', name: 'Abhitenjay', type: 'Student', leaveType: 'Casual Leave', startDate: '2025-07-05', endDate: '2025-07-05', status: 'approved' }
    ];

    // ===== DATE FILTERING LOGIC =====
    function filterApplicationsByDate(filter) {
        const today = new Date();
        const tableBody = document.getElementById('applicationsTableBody');
        tableBody.innerHTML = '';

        let filteredData = [];

        allApplicationsData.forEach(app => {
            const appDate = new Date(app.startDate);
            let showApp = false;

            if (filter === 'week') {
                // Show applications from last 7 days
                const weekAgo = new Date(today);
                weekAgo.setDate(today.getDate() - 7);
                showApp = appDate >= weekAgo;
            } else if (filter === 'month') {
                // Show applications from this month
                showApp = appDate.getMonth() === today.getMonth() && appDate.getFullYear() === today.getFullYear();
            } else if (filter === '6months') {
                // Show applications from last 6 months
                const sixMonthsAgo = new Date(today);
                sixMonthsAgo.setMonth(today.getMonth() - 6);
                showApp = appDate >= sixMonthsAgo;
            }

            if (showApp) {
                filteredData.push(app);
            }
        });

        // Populate table with filtered data
        if (filteredData.length === 0) {
            tableBody.innerHTML = '<tr><td colspan="7" style="text-align:center; color:#777; padding: 2rem;">No applications found for this period</td></tr>';
        } else {
            filteredData.forEach(app => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${app.id}</td>
                    <td>${app.name}</td>
                    <td>${app.type}</td>
                    <td>${app.leaveType}</td>
                    <td>${app.startDate}</td>
                    <td>${app.endDate}</td>
                    <td><span class="status-badge ${app.status}">${app.status.charAt(0).toUpperCase() + app.status.slice(1)}</span></td>
                `;
                tableBody.appendChild(tr);
            });
        }
    }

    // ===== TIME FILTER DROPDOWN =====
    const timeFilter = document.getElementById('timeFilter');
    
    // Load table with default "This Week" filter on page load
    filterApplicationsByDate('week');

    // Update table when filter changes
    timeFilter.addEventListener('change', () => {
        filterApplicationsByDate(timeFilter.value);
    });
</script>
</body>
</html>
